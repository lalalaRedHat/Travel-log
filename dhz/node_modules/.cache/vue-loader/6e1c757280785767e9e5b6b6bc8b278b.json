{"remainingRequest":"D:\\WEB2007\\参赛项目\\Travel-log\\dhz\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\WEB2007\\参赛项目\\Travel-log\\dhz\\src\\views\\KeepDiary.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"D:\\WEB2007\\参赛项目\\Travel-log\\dhz\\src\\views\\KeepDiary.vue","mtime":1606213494139},{"path":"D:\\WEB2007\\参赛项目\\Travel-log\\dhz\\node_modules\\css-loader\\dist\\cjs.js","mtime":1605537524090},{"path":"D:\\WEB2007\\参赛项目\\Travel-log\\dhz\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1605537543925},{"path":"D:\\WEB2007\\参赛项目\\Travel-log\\dhz\\node_modules\\postcss-loader\\src\\index.js","mtime":1605537534774},{"path":"D:\\WEB2007\\参赛项目\\Travel-log\\dhz\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1605537519619},{"path":"D:\\WEB2007\\参赛项目\\Travel-log\\dhz\\node_modules\\vue-loader\\lib\\index.js","mtime":1605537543923}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KLyog5a+86Iiq5oyJ6ZKuICovDQoua2VlcERpYXJ5IC52YW4tYnV0dG9uLS1yb3VuZHsNCiAgYm9yZGVyLXJhZGl1czogNTBweDsNCiAgaGVpZ2h0OiAyNHB4Ow0KfQ0KLmtlZXBEaWFyeSAudmFuLW5hdi1iYXJfX2xlZnQsIC52YW4tbmF2LWJhcl9fcmlnaHR7DQogIGZvbnQtc2l6ZTogMjRweDsNCn0NCi8qIOato+aWhyAqLw0KLmtlZXBEaWFyeSAuZGlhcnl0ZXh0ew0KICBtYXJnaW4tdG9wOiA0NnB4Ow0KfQ0KLmtlZXBEaWFyeSAuZGlhcnl0ZXh0IC52YW4tY2VsbHsNCiAgcGFkZGluZzogMDsNCn0NCi5rZWVwRGlhcnkgLmRpYXJ5dGV4dCAudmFuLWNlbGxfX3ZhbHVlLS1hbG9uZXsNCiAgYmFja2dyb3VuZDogcmdiKDI1MCwgMjUwLCAyNTApOw0KICBwYWRkaW5nOiAxNXB4Ow0KfQ0KLmtlZXBEaWFyeSAuZGlhcnl0ZXh0IC52YW4tZmllbGRfX2NvbnRyb2x7DQogIHRleHQtaW5kZW50OjJlbTsNCn0NCi8qIOWbvueJh+S4iuS8oCAqLw0KLmtlZXBEaWFyeSAucGljVXBsb2Fkew0KICBtYXJnaW4tbGVmdDogOHB4Ow0KICBtYXJnaW4tdG9wOiA4cHg7DQp9DQovKiDlvZPliY3ln47luIIgKi8NCi5rZWVwRGlhcnkgLmN1cnJlbnRfY2l0eXsNCiAgYm9yZGVyLXRvcDogMXB4IHNvbGlkIHJnYigyNTAsIDI1MCwgMjUwKTsNCiAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHJnYigyNTAsIDI1MCwgMjUwKTsNCn0NCg=="},{"version":3,"sources":["KeepDiary.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"KeepDiary.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n  <div class=\"keepDiary\">\r\n    <!-- 导航栏 -->\r\n    <van-nav-bar title=\"发布日志\" left-arrow fixed border class=\"navb\">\r\n      <template #left>\r\n        <router-link to=\"/\">\r\n          <van-icon name=\"arrow-left\" color=\"#000\" size=\"24\"  /> \r\n        </router-link>\r\n      </template>\r\n      <template #right>\r\n        <van-button round type=\"info\" size=\"small\" color=\"#5ABCC8\" @click=\"release\">发布</van-button>\r\n      </template>\r\n    </van-nav-bar>\r\n    <!-- 导航栏结束 -->\r\n\r\n    <!-- 正文开始 -->\r\n    <div class=\"diarytext\">\r\n      <van-field\r\n        v-model=\"article\"\r\n        rows=\"8\"\r\n        type=\"textarea\"\r\n        maxlength=\"3000\"\r\n        placeholder=\"随手分享下你的旅行日志吧！\"\r\n        show-word-limit\r\n      />\r\n    </div>\r\n    <!-- 正文结束 -->\r\n    <!-- 图片上传开始 -->\r\n    <div class=\"picUpload\">\r\n      <van-uploader v-model=\"fileList\" multiple :max-count=\"8\" :after-read=\"afterRead\" accept=\"image/png,image/jpeg,image/jpg\"/>\r\n    </div>\r\n    <!-- 图片上传结束 -->\r\n    <!-- 标题开始 -->\r\n    <van-cell-group>\r\n      <van-field v-model=\"article_tit\" label=\"文章标题\" placeholder=\"请填写文章标题\" label-width=\"4.2em\"/>\r\n    </van-cell-group>\r\n    <!-- 标题结束 -->\r\n    <!-- 城市位置开始 -->\r\n    <van-cell-group>\r\n      <van-field\r\n        readonly\r\n        clickable\r\n        name=\"current_city\"\r\n        :value=\"current_city\"\r\n        label=\"当前城市\"\r\n        label-width=\"4.2em\"\r\n        placeholder=\"点击选择城市\"\r\n        @click=\"showcity = true\"\r\n      />\r\n      <van-popup v-model=\"showcity\" position=\"bottom\">\r\n        <van-picker\r\n          show-toolbar\r\n          :columns=\"city\"\r\n          @confirm=\"oncity\"\r\n          @change=\"onChange\"\r\n          @cancel=\"showcity = false\"\r\n        />\r\n      </van-popup>\r\n    </van-cell-group>\r\n    <!-- 城市位置结束 -->\r\n    <!-- 文章分类开始 -->\r\n    <van-cell-group>\r\n      <van-field\r\n        readonly\r\n        clickable\r\n        name=\"classify\"\r\n        :value=\"classify\"\r\n        label=\"文章分类\"\r\n        label-width=\"4.2em\"\r\n        placeholder=\"点击选择分类\"\r\n        @click=\"showclassify = true\"\r\n      />\r\n      <van-popup v-model=\"showclassify\" position=\"bottom\">\r\n        <van-picker\r\n          show-toolbar\r\n          :columns=\"diaryclassify\"\r\n          @confirm=\"onclassify\"\r\n          @cancel=\"showclassify = false\"\r\n        />\r\n      </van-popup>\r\n    </van-cell-group>\r\n    <!-- 文章分类结束 -->\r\n  </div>\r\n</template>\r\n\r\n<style>\r\n/* 导航按钮 */\r\n.keepDiary .van-button--round{\r\n  border-radius: 50px;\r\n  height: 24px;\r\n}\r\n.keepDiary .van-nav-bar__left, .van-nav-bar__right{\r\n  font-size: 24px;\r\n}\r\n/* 正文 */\r\n.keepDiary .diarytext{\r\n  margin-top: 46px;\r\n}\r\n.keepDiary .diarytext .van-cell{\r\n  padding: 0;\r\n}\r\n.keepDiary .diarytext .van-cell__value--alone{\r\n  background: rgb(250, 250, 250);\r\n  padding: 15px;\r\n}\r\n.keepDiary .diarytext .van-field__control{\r\n  text-indent:2em;\r\n}\r\n/* 图片上传 */\r\n.keepDiary .picUpload{\r\n  margin-left: 8px;\r\n  margin-top: 8px;\r\n}\r\n/* 当前城市 */\r\n.keepDiary .current_city{\r\n  border-top: 1px solid rgb(250, 250, 250);\r\n  border-bottom: 1px solid rgb(250, 250, 250);\r\n}\r\n</style>\r\n\r\n<script>\r\nconst citys = {\r\n    北京市: [],\r\n    天津市: [],\r\n    河北省: ['石家庄市','唐山市','秦皇岛市','邯郸市','邢台市','保定市','张家口市','承德市','沧州市','廊坊市','衡水市','雄安新区'],\r\n    山西省: ['太原市','大同市','阳泉市','长治市','晋城市','朔州市','晋中市','运城市','忻州市','临汾市','吕梁市'],\r\n    内蒙古自治区: ['呼和浩特市','包头市','乌海市','赤峰市','通辽市','鄂尔多斯市','呼伦贝尔市','巴彦淖尔市','乌兰察布市','兴安盟','锡林郭勒盟','阿拉善盟'],\r\n    辽宁省: ['沈阳市','大连市','鞍山市','抚顺市','本溪市','丹东市','锦州市','营口市','阜新市','辽阳市','盘锦市','铁岭市','朝阳市','葫芦岛市'],\r\n    吉林省: ['长春市','吉林市','四平市','辽源市','通化市','白山市','松原市','白城市','长白山管委会','延边朝鲜族自治州'],\r\n    黑龙江省: ['哈尔滨市','齐齐哈尔市','鸡西市','鹤岗市','双鸭山市','大庆市','伊春市','佳木斯市','七台河市','牡丹江市','黑河市','绥化市','大兴安岭地区'],\r\n    上海市: [],\r\n    江苏省: ['南京市','无锡市','徐州市','常州市','苏州市','南通市','连云港市','淮安市','盐城市','扬州市','镇江市','泰州市','宿迁市'],\r\n    浙江省: ['杭州市','宁波市','温州市','嘉兴市','湖州市','绍兴市','金华市','衢州市','舟山市','台州市','丽水市'],\r\n    安徽省: ['合肥市','芜湖市','蚌埠市','淮南市','马鞍山市','淮北市','铜陵市','安庆市','黄山市','滁州市','阜阳市','宿州市','六安市','亳州市','池州市','宣城市'],\r\n    福建省: ['福州市','厦门市','莆田市','三明市','泉州市','漳州市','南平市','龙岩市','宁德市'],\r\n    江西省: ['南昌市','景德镇市','萍乡市','九江市','新余市','鹰潭市','赣州市','吉安市','宜春市','抚州市','上饶市'],\r\n    山东省: ['济南市','青岛市','淄博市','枣庄市','东营市','烟台市','潍坊市','济宁市','泰安市','威海市','日照市','临沂市','德州市','聊城市','滨州市','菏泽市'],\r\n    河南省: ['郑州市','开封市','洛阳市','平顶山市','安阳市','鹤壁市','新乡市','焦作市','濮阳市','许昌市','漯河市','三门峡市','南阳市','商丘市','信阳市','周口市','驻马店市','省直辖县'],\r\n    湖北省: ['武汉市','黄石市','十堰市','宜昌市','襄阳市','鄂州市','荆门市','孝感市','荆州市','黄冈市','咸宁市','随州市','恩施土家族苗族自治州','省直辖县'],\r\n    湖南省: ['长沙市','株洲市','湘潭市','衡阳市','邵阳市','岳阳市','常德市','张家界市','益阳市','郴州市','永州市','怀化市','娄底市','湘西土家族苗族自治州'],\r\n    广东省: ['广州市','韶关市','深圳市','珠海市','汕头市','佛山市','江门市','湛江市','茂名市','肇庆市','惠州市','梅州市','汕尾市','河源市','阳江市','清远市','东莞市','中山市','潮州市','揭阳市','云浮市'],\r\n    广西壮族自治区: ['南宁市','柳州市','桂林市','梧州市','北海市','防城港市','钦州市','贵港市','玉林市','百色市','贺州市','河池市','来宾市','崇左市'],\r\n    海南省: ['海口市','三亚市','三沙市','儋州市','省直辖县'],\r\n    重庆市: [],\r\n    四川省: ['成都市','自贡市','攀枝花市','泸州市','德阳市','绵阳市','广元市','遂宁市','内江市','乐山市','南充市','眉山市','宜宾市','广安市','达州市','雅安市','巴中市','资阳市','阿坝藏族羌族自治州','甘孜藏族自治州','凉山彝族自治州'],\r\n    贵州省: ['贵阳市','六盘水市','遵义市','安顺市','毕节市','铜仁市','黔西南布依族苗族自治州','黔东南苗族侗族自治州','黔南布依族苗族自治州'],\r\n    云南省: ['昆明市','曲靖市','玉溪市','保山市','昭通市','丽江市','普洱市','临沧市','楚雄彝族自治州','红河哈尼族彝族自治州','文山壮族苗族自治州','西双版纳傣族自治州','大理白族自治州','德宏傣族景颇族自治州','怒江傈僳族自治州','迪庆藏族自治州'],\r\n    西藏自治区: ['拉萨市','日喀则市','昌都市','林芝市','山南市','那曲市','阿里地区'],\r\n    陕西省: ['西安市','铜川市','宝鸡市','咸阳市','渭南市','延安市','汉中市','榆林市','安康市','商洛市'],\r\n    甘肃省: ['兰州市','嘉峪关市','金昌市','白银市','天水市','武威市','张掖市','平凉市','酒泉市','庆阳市','定西市','陇南市','临夏回族自治州','甘南藏族自治州'],\r\n    青海省: ['西宁市','海东市','海北藏族自治州','黄南藏族自治州','海南藏族自治州','果洛藏族自治州','玉树藏族自治州','海西蒙古族藏族自治州'],\r\n    宁夏回族自治区: ['银川市','石嘴山市','吴忠市','固原市','中卫市'],\r\n    新疆维吾尔自治区: ['乌鲁木齐市','克拉玛依市','吐鲁番市','哈密市','昌吉回族自治州','博尔塔拉蒙古自治州','巴音郭楞蒙古自治州','阿克苏地区','克孜勒苏柯尔克孜自治州','喀什地区','和田地区','伊犁哈萨克自治州','塔城地区','阿勒泰地区','自治区直辖县级行政区划'],\r\n    台湾省: ['台北市','高雄市','台南市','台中市','金门县','南投县','基隆市','新竹市','嘉义市','新北市','宜兰县','新竹县','桃园县','苗栗县','彰化县','嘉义县','云林县','屏东县','台东县','花莲县','澎湖县','连江县'],\r\n    香港特别行政区: ['香港岛','九龙','新界'],\r\n    澳门特别行政区: ['澳门半岛','离岛'],\r\n};\r\nexport default {\r\n  data(){\r\n    return {\r\n      // 文章正文\r\n      article:\"\",\r\n      // 文章标题\r\n      article_tit:\"\",\r\n      // 上传的图片\r\n      fileList: [],\r\n      // 当前城市\r\n      current_city:\"\",\r\n      // city: ['杭州', '宁波', '温州', '嘉兴', '湖州'],\r\n      city: [\r\n        {\r\n          values: Object.keys(citys),\r\n          className: 'column1',\r\n        },\r\n        {\r\n          values: citys['浙江'],\r\n          className: 'column2',\r\n          defaultIndex: 2,\r\n        },\r\n      ],\r\n      showcity: false,\r\n\r\n\r\n      // 文章分类\r\n      classify:\"\",\r\n      diaryclassify:[],\r\n      showclassify: false,\r\n      // 是否上传\r\n      data:{}\r\n    }\r\n  },\r\n  methods: {\r\n    // 获取图片读取后的参数\r\n    afterRead(file) {\r\n      console.log(file);\r\n      // 创建表单数据对象\r\n      let formData = new FormData();\r\n      // 如果传的参的content属性存在则为对象\r\n      if (file.hasOwnProperty('content')) {\r\n\r\n        // 直接保存到data中\r\n        formData.append('journal_pic',file.file);\r\n        // 保存在变量data中\r\n        this.data = formData;\r\n\r\n      } else {//否则为数组\r\n\r\n        // 循环遍历获取\r\n        for (let i = 0, n = file.length; i < n; i++) {\r\n          //获取到File对象\r\n          let files = file[i].file;\r\n          // console.log(file[i].file);\r\n          formData.append('journal_pic',files);\r\n        }\r\n        // 保存在变量data中\r\n        this.data = formData;\r\n\r\n      }\r\n    },\r\n\r\n    \r\n    // 城市选择\r\n    oncity(value) {\r\n      this.current_city = value[0] + value[1];\r\n      this.showcity = false;\r\n    },\r\n    // 切换省\r\n    onChange(picker, values) {\r\n      picker.setColumnValues(1, citys[values[0]]);\r\n    },\r\n\r\n\r\n\r\n\r\n    // 分类的选择器\r\n    onclassify(value){\r\n      this.classify = value;\r\n      this.showclassify = false;\r\n    },\r\n    // 发布日志\r\n    release(){\r\n      // 获取登录状态\r\n      let isOnlogin = this.$store.state.isOnlogin;\r\n      // 如果登录状态为1则为登录\r\n      if ( isOnlogin == 1) {\r\n        // 获取当前时间\r\n        let current_time = this.moment().format('x');\r\n\r\n\r\n        // 声明一个变量保存对应的分类id\r\n        let classify_id;\r\n        // 保存获取的分类数组\r\n        let classify_arr = this.$store.state.classify;\r\n        // 循环分类数组\r\n        classify_arr.forEach((value, index, array) => {\r\n          // 如果选中文章分类名等于分类数组里的名\r\n          if ( this.classify ==  value.classify) {\r\n            // 就将当前id赋值给classify_id\r\n            classify_id = value.cid\r\n          }\r\n        })\r\n\r\n\r\n        // 当什么都没没写时不允许提交\r\n        if ( !this.article_tit || !this.article || !this.current_city || !this.classify ) {\r\n          // 没写东西没有动作\r\n          this.$toast.fail('请填写日志内容');\r\n          return\r\n\r\n        } else { // 写了东西\r\n\r\n            // 获取保存的formdata\r\n            let formData = this.data;\r\n    \r\n            // 在表单数据对象中添加数据\r\n            // 日志标题\r\n            formData.set(\"journal_title\",this.article_tit);\r\n            // 日志正文\r\n            formData.set(\"content\",this.article);\r\n            // 发布时间\r\n            formData.set(\"log_time\",current_time);\r\n            // 当前城市\r\n            formData.set(\"journal_city\",this.current_city);\r\n            // 当前分类\r\n            formData.set(\"journal_classify\",classify_id);\r\n            // 用户id\r\n            formData.set(\"users_id\",1);\r\n\r\n            console.log(formData);\r\n            // 提交表单\r\n            this.axios.post('/journal/diaryadd',formData).then( res => {\r\n              // 获取到code为1跳转到首页\r\n              if (res.data.code == 1) {\r\n                this.$notify({\r\n                  type: 'success',\r\n                  message: '发布成功' \r\n                });\r\n                this.$router.push('/');\r\n              }\r\n\r\n            })\r\n        }\r\n\r\n\r\n      } else { // 为未登录\r\n        this.$toast.fail('请登录后发布');\r\n      }\r\n\r\n    }\r\n\r\n\r\n  },\r\n  mounted(){\r\n    // 分类选择器获取数据数组\r\n    let classifys = this.$store.state.classify;\r\n    classifys.forEach((value, index, array) => {\r\n      this.diaryclassify.push(value.classify)\r\n    })\r\n\r\n  }\r\n}\r\n</script>\r\n"]}]}